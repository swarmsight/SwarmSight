// SwarmSight Markdown Formatter

/**
 * Markdown output formatter for SwarmSight scan results
 */

function format(results) {
  const timestamp = new Date(results.metadata.timestamp).toLocaleString();

  let markdown = `# 🔍 SwarmSight Security Report

**Generated:** ${timestamp}  
**Tool Version:** SwarmSight v${results.metadata.version}  
**Scanned Path:** ${results.metadata.options.projectPath}

## Summary

| Severity | Count |
|----------|-------|
| Critical | ${results.summary.critical} |
| High     | ${results.summary.high} |
| Medium   | ${results.summary.medium} |
| Low      | ${results.summary.low} |
| Info     | ${results.summary.info} |
| **Total** | **${results.summary.total}** |

## Findings

`;

  if (results.findings.length === 0) {
    markdown += "No security findings detected. ✅\n";
  } else {
    results.findings.forEach((finding, index) => {
      const severityEmoji = {
        critical: "🔴",
        high: "🟠",
        medium: "🟡",
        low: "🔵",
        info: "⚪",
      };

      markdown += `### ${index + 1}. ${finding.message}

${
  severityEmoji[finding.severity]
} **Severity:** ${finding.severity.toUpperCase()}

- **File:** \`${finding.file}\`
- **Location:** Line ${finding.line}, Column ${finding.column}
- **Rule:** \`${finding.rule}\`
- **Checker:** ${finding.checker}

${finding.description ? `**Description:** ${finding.description}` : ""}

---

`;
    });
  }

  markdown += `## Metadata

- **Scan Options:** ${JSON.stringify(results.metadata.options, null, 2)}
- **Generated by:** SwarmSight Security Scanner
- **Documentation:** https://swarmsight.io/docs

`;

  return markdown;
}

function getFileExtension() {
  return ".md";
}

function getMimeType() {
  return "text/markdown";
}

module.exports = {
  format,
  getFileExtension,
  getMimeType,
};
